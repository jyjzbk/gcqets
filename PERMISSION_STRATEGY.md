# 菜单权限策略

## 🎯 权限设计原则

### 1. 最小权限原则
- 用户只能看到和访问其角色允许的功能
- 避免显示无权限访问的菜单项，减少用户困惑

### 2. 角色分层管理
- 系统管理员：最高权限，可访问所有功能
- 组织管理员：管理本组织的实验教学
- 教师：创建计划和记录，查看审核结果

### 3. 功能导向设计
- 菜单结构反映实际工作流程
- 权限控制既在菜单层面，也在功能层面

## 👥 用户角色定义

### 系统管理员 (admin)
- **权限范围**：全系统
- **主要职责**：系统维护、全局管理、数据监控
- **菜单权限**：所有菜单项

### 学校管理员 (school_admin)
- **权限范围**：本校
- **主要职责**：学校实验教学管理、审核本校记录
- **菜单权限**：除系统测试外的所有功能

### 区域管理员 (district_admin)
- **权限范围**：本区域
- **主要职责**：区域实验教学管理、审核区域内记录
- **菜单权限**：除系统测试外的所有功能

### 教师 (teacher)
- **权限范围**：个人
- **主要职责**：创建实验计划、填报实验记录
- **菜单权限**：计划申报、记录填报、测试功能

## 📋 菜单权限矩阵

| 菜单项 | 系统管理员 | 学校管理员 | 区域管理员 | 教师 | 说明 |
|--------|------------|------------|------------|------|------|
| 🏠 仪表板 | ✅ | ✅ | ✅ | ✅ | 所有用户 |
| 🏢 组织机构管理 | ✅ | ✅ | ✅ | ❌ | 管理员功能 |
| 🎓 学校信息管理 | ✅ | ✅ | ✅ | ❌ | 管理员功能 |
| 👥 用户管理 | ✅ | ✅ | ✅ | ❌ | 管理员功能 |
| 🔑 角色管理 | ✅ | ✅ | ✅ | ❌ | 管理员功能 |
| 🗂️ 权限管理 | ✅ | ❌ | ❌ | ❌ | 仅系统管理员 |
| 📚 基础数据管理 | ✅ | ✅ | ✅ | ❌ | 管理员功能 |
| 📦 设备物料管理 | ✅ | ✅ | ✅ | ✅ | 所有用户 |
| **🔬 实验过程管理** | | | | | **新功能模块** |
| ├─ 📅 实验计划申报 | ✅ | ✅ | ✅ | ✅ | 所有用户 |
| ├─ ✏️ 实验记录填报 | ✅ | ✅ | ✅ | ✅ | 所有用户 |
| ├─ ✅ 实验记录审核 | ✅ | ✅ | ✅ | ❌ | 仅管理员 |
| ├─ 🔧 系统功能测试 | ✅ | ❌ | ❌ | ❌ | 仅系统管理员 |
| ├─ 🧪 菜单功能测试 | ✅ | ✅ | ✅ | ✅ | 调试功能 |
| └─ 🎨 图标测试 | ✅ | ✅ | ✅ | ✅ | 调试功能 |

## 🔧 技术实现

### 权限检查函数

```javascript
// 系统管理员检查
const isAdmin = computed(() => {
  return authStore.user?.user_type === 'admin'
})

// 管理员检查（包含各级管理员）
const isManager = computed(() => {
  const userType = authStore.user?.user_type
  return ['admin', 'school_admin', 'district_admin'].includes(userType)
})

// 教师检查
const isTeacher = computed(() => {
  const userType = authStore.user?.user_type
  return userType === 'teacher'
})

// 审核权限检查
const canAccessReview = computed(() => {
  return isManager.value
})

// 测试功能权限检查
const canAccessTest = computed(() => {
  return isAdmin.value || import.meta.env.DEV
})
```

### 菜单条件渲染

```vue
<!-- 所有用户可见 -->
<el-menu-item index="/experiment-plans">
  <el-icon><Calendar /></el-icon>
  <span>实验计划申报</span>
</el-menu-item>

<!-- 仅管理员可见 -->
<el-menu-item v-if="canAccessReview" index="/experiment-review">
  <el-icon><Select /></el-icon>
  <span>实验记录审核</span>
</el-menu-item>

<!-- 仅系统管理员可见 -->
<el-menu-item v-if="canAccessTest" index="/system-test">
  <el-icon><Tools /></el-icon>
  <span>系统功能测试</span>
</el-menu-item>
```

## 🎭 测试账号权限

### 系统管理员测试
```
账号：sysadmin
密码：123456
权限：所有菜单项都可见
```

### 学校管理员测试
```
账号：dongcheng_principal
密码：123456
权限：除系统测试外都可见
```

### 区域管理员测试
```
账号：lianzhou_admin
密码：123456
权限：除系统测试外都可见
```

### 教师测试
```
账号：hh78@163.com
密码：123456
权限：基础功能 + 计划申报 + 记录填报
```

## 🔍 权限验证方法

### 1. 菜单显示验证
- 使用不同角色账号登录
- 检查左侧菜单栏显示的项目
- 确认权限控制是否正确

### 2. 功能访问验证
- 直接访问URL测试权限控制
- 检查页面内部的权限限制
- 验证API接口的权限检查

### 3. 权限测试页面
访问 `/menu-test` 查看：
- 当前用户信息
- 菜单权限矩阵
- 导航功能测试

## 🚀 权限扩展

### 未来可扩展的权限功能

1. **细粒度权限**
   - 功能级权限控制
   - 数据级权限控制
   - 操作级权限控制

2. **动态权限**
   - 基于时间的权限
   - 基于条件的权限
   - 临时权限授予

3. **权限继承**
   - 角色权限继承
   - 组织权限继承
   - 功能权限组合

## 📊 权限监控

### 权限使用统计
- 各角色菜单访问频率
- 权限拒绝统计
- 功能使用分析

### 安全审计
- 权限变更日志
- 异常访问记录
- 权限滥用检测

## 🎯 最佳实践

### 1. 权限设计
- 遵循最小权限原则
- 权限粒度适中
- 易于理解和维护

### 2. 用户体验
- 隐藏无权限菜单
- 提供清晰的权限说明
- 友好的权限拒绝提示

### 3. 安全考虑
- 前后端双重验证
- 敏感操作二次确认
- 定期权限审查

---

**权限策略版本**：v1.0  
**更新时间**：2025-07-03  
**适用范围**：实验教学管理系统
