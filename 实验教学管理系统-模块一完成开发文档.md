# 实验教学管理系统 - 模块一：组织机构管理 完成开发文档

## 项目基本信息

**项目名称**: 实验教学管理系统 (GCQETS - General Chemistry Quality Education Teaching System)  
**模块名称**: 模块一：组织机构管理  
**开发状态**: ✅ 已完成  
**文档版本**: v1.0  
**完成日期**: 2025-06-28  
**项目路径**: F:\xampp\htdocs\gcqets  
**数据库**: gcqets (账号: root, 密码: liningyu2000)

## 技术架构

### 前端技术栈
- **Vue 3.3.4** + Composition API
- **Vue Router 4.2.4** (路由管理)
- **Pinia 2.1.6** (状态管理)
- **Element Plus 2.9.5** (UI组件库)
- **Axios 1.4.0** (HTTP客户端)
- **Vite 4.5.9** (构建工具)

### 后端技术栈
- **PHP 8.2.12**
- **Laravel 12.0.1** (Web框架)
- **MySQL/MariaDB 10.4.32** (数据库)
- **Laravel Sanctum** (API认证)
- **Composer 2.6.10** (依赖管理)

## 模块一：组织机构管理 - 已完成功能

### 1. 核心功能特性 ✅

#### 1.1 五级组织架构
```
第1级: 省级 (Province) - 管理全省所有下级单位
第2级: 市级 (City) - 管理本市所有下级单位  
第3级: 区县级 (District) - 管理本区县所有下级单位
第4级: 学区级 (Education Zone) - 管理本学区所有学校
第5级: 学校级 (School) - 仅管理本校事务
```

#### 1.2 组织机构管理功能
- ✅ **树形结构展示** - 支持五级组织架构的树形展示
- ✅ **CRUD操作** - 创建、查看、编辑、删除组织机构
- ✅ **权限控制** - 上级可管理下级，同级不可互相管理
- ✅ **数据范围控制** - 根据用户权限显示可访问的组织
- ✅ **拖拽移动** - 支持组织机构的拖拽移动
- ✅ **搜索过滤** - 支持按名称、层级、状态搜索
- ✅ **批量操作** - 支持批量启用/禁用组织

#### 1.3 学校信息管理
- ✅ **学校批量导入** - Excel文件批量导入学校信息
- ✅ **学校详细信息** - 学生数量、校园面积、学校代码等
- ✅ **统计仪表板** - 导入统计、分布统计、状态统计
- ✅ **区域划分管理** - 学区与学校的关联管理

#### 1.4 权限可视化管理
- ✅ **权限继承关系** - 五级组织权限继承树形展示
- ✅ **权限矩阵** - 用户权限矩阵表格显示
- ✅ **审计日志** - 权限操作历史记录
- ✅ **统计分析** - 权限分配统计数据

### 2. 数据库设计 ✅

#### 2.1 核心数据表
```sql
-- 组织机构表
CREATE TABLE organizations (
    id BIGINT PRIMARY KEY,
    name VARCHAR(100) NOT NULL COMMENT '组织机构名称',
    code VARCHAR(50) UNIQUE NOT NULL COMMENT '组织机构编码',
    type ENUM('province','city','district','education_zone','school') NOT NULL,
    level TINYINT NOT NULL COMMENT '组织层级 1-5',
    parent_id BIGINT NULL COMMENT '父级组织ID',
    full_path VARCHAR(500) NULL COMMENT '完整路径',
    description TEXT NULL,
    contact_person VARCHAR(50) NULL,
    contact_phone VARCHAR(20) NULL,
    address VARCHAR(200) NULL,
    longitude DECIMAL(10,7) NULL,
    latitude DECIMAL(10,7) NULL,
    status ENUM('active','inactive','suspended') DEFAULT 'active',
    sort_order INT DEFAULT 0,
    extra_data JSON NULL,
    -- 学校专用字段
    student_count INT NULL COMMENT '学生数量',
    campus_area DECIMAL(10,2) NULL COMMENT '校园面积',
    school_code VARCHAR(50) NULL COMMENT '学校代码',
    school_type VARCHAR(50) NULL COMMENT '学校类型',
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    deleted_at TIMESTAMP NULL
);
```

#### 2.2 示例数据结构
```
河北省 (ID:1, Level:1, Type:province)
└── 石家庄市 (ID:2, Level:2, Type:city, Parent:1)
    └── 藁城区 (ID:3, Level:3, Type:district, Parent:2)
        └── 廉州学区 (ID:4, Level:4, Type:education_zone, Parent:3)
            └── 东城小学 (ID:5, Level:5, Type:school, Parent:4)
```

### 3. API接口设计 ✅

#### 3.1 组织机构接口
```php
// 基础CRUD
GET    /api/organizations              // 获取组织列表(支持树形/分页)
GET    /api/organizations/tree         // 获取组织树形结构
GET    /api/organizations/parent-options // 获取父级选项
GET    /api/organizations/{id}         // 获取组织详情
POST   /api/organizations              // 创建组织
PUT    /api/organizations/{id}         // 更新组织
DELETE /api/organizations/{id}         // 删除组织

// 高级功能
GET    /api/organizations/{id}/children // 获取子组织
POST   /api/organizations/{id}/move     // 移动组织
POST   /api/organizations/batch-update  // 批量更新
```

#### 3.2 学校管理接口
```php
GET    /api/schools                    // 获取学校列表
POST   /api/schools/import             // 批量导入学校
GET    /api/schools/import/template    // 下载导入模板
GET    /api/schools/stats              // 获取学校统计
```

#### 3.3 权限管理接口
```php
GET    /api/permission-management/inheritance-tree  // 权限继承树
GET    /api/permission-management/permission-matrix // 权限矩阵
GET    /api/permission-management/audit-logs        // 审计日志
GET    /api/permission-management/stats             // 统计数据
```

### 4. 前端组件架构 ✅

#### 4.1 核心组件
```
frontend/src/views/organization/
├── OrganizationList.vue           // 组织机构列表页面
├── OrganizationForm.vue           // 组织机构表单组件
├── SchoolManagement.vue           // 学校管理页面
└── SchoolImport.vue               // 学校批量导入组件

frontend/src/components/
├── OrganizationTree.vue           // 组织机构树组件
├── SchoolForm.vue                 // 学校表单组件
└── ImportProgress.vue             // 导入进度组件

frontend/src/views/permission/
├── EducationPermissionManager.vue // 教育权限管理(简化版)
└── PermissionVisualizationTest.vue // 权限可视化管理(完整版)
```

#### 4.2 状态管理
```javascript
// frontend/src/stores/organization.js
export const useOrganizationStore = defineStore('organization', () => {
  const organizations = ref([])
  const organizationTree = ref([])
  const currentOrganization = ref(null)
  const loading = ref(false)
  const total = ref(0)

  // 核心方法
  const getOrganizations = async (params = {}) => { ... }
  const getOrganizationTree = async (params = {}) => { ... }
  const createOrganization = async (data) => { ... }
  const updateOrganization = async (id, data) => { ... }
  const deleteOrganization = async (id) => { ... }
  const moveOrganization = async (id, data) => { ... }
})
```

#### 4.3 API服务层
```javascript
// frontend/src/api/organization.js
export const organizationApi = {
  getList(params) { return request.get('/organizations', { params }) },
  getTree(params) { return request.get('/organizations/tree', { params }) },
  getDetail(id) { return request.get(`/organizations/${id}`) },
  create(data) { return request.post('/organizations', data) },
  update(id, data) { return request.put(`/organizations/${id}`, data) },
  delete(id) { return request.delete(`/organizations/${id}`) },
  move(id, data) { return request.post(`/organizations/${id}/move`, data) }
}
```

### 5. 权限控制系统 ✅

#### 5.1 权限层级设计
```php
// 用户权限级别
1 => '系统管理员',    // 全系统权限
2 => '省级管理员',    // 省级及以下权限
3 => '市级管理员',    // 市级及以下权限
4 => '区县管理员',    // 区县级及以下权限
5 => '学区管理员',    // 学区级及以下权限
6 => '校长',         // 学校级权限
7 => '副校长',       // 学校级部分权限
8 => '教务主任',     // 教务相关权限
9 => '实验教师',     // 实验教学权限
10 => '普通教师'     // 基础权限
```

#### 5.2 数据访问控制
```php
// 后端权限控制示例
public function getDataAccessScope()
{
    $user = Auth::user();
    
    if ($user->hasRole('系统管理员')) {
        return ['type' => 'all'];
    }
    
    if ($user->hasRole(['省级管理员', '市级管理员', '区县管理员'])) {
        return [
            'type' => 'specific',
            'organizations' => $user->getAccessibleOrganizations()
        ];
    }
    
    return ['type' => 'none'];
}
```

### 6. 测试数据 ✅

#### 6.1 测试账户
```
系统管理员: sysadmin / 123456
学区管理员: lianzhou_admin / 123456  
校长用户: dongcheng_principal / 123456
```

#### 6.2 示例组织架构
```
河北省
└── 石家庄市
    └── 藁城区
        └── 廉州学区
            ├── 东城小学 (学生:1200人, 面积:15000㎡)
            ├── 西城小学 (学生:800人, 面积:12000㎡)
            └── 南城小学 (学生:600人, 面积:8000㎡)
```

## 项目部署说明

### 开发环境
- **前端**: http://localhost:5173 (Vite开发服务器)
- **后端**: http://localhost/gcqets/backend/public (XAMPP)
- **数据库**: localhost:3306/gcqets

### 启动命令
```bash
# 前端启动
cd frontend
npm run dev

# 后端启动 (XAMPP环境)
# 确保Apache和MySQL服务已启动
# 访问: http://localhost/gcqets/backend/public
```

## 下一步开发建议

### 模块二：基础数据管理
建议开发以下功能模块，与组织机构管理形成良好关联：

1. **实验室管理** - 基于学校组织的实验室信息管理
2. **设备器材管理** - 实验设备的分类、库存、分配管理
3. **课程体系管理** - 实验课程的设置和管理
4. **教师信息管理** - 基于组织架构的教师信息管理

这些模块都将基于已完成的组织机构架构，实现数据的层级管理和权限控制。
