# æ¨¡å—ä¸‰ï¼šå®éªŒè¿‡ç¨‹ç®¡ç† - è¯¦ç»†å¼€å‘è§„åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**æ¨¡å—åç§°**ï¼šæ¨¡å—ä¸‰ - å®éªŒè¿‡ç¨‹ç®¡ç†  
**å¼€å‘æ—¶é—´**ï¼š2025å¹´7æœˆ  
**æŠ€æœ¯æ ˆ**ï¼šLaravel 11 + Vue 3 + Element Plus + MySQL  
**ä¾èµ–æ¨¡å—**ï¼šæ¨¡å—ä¸€ï¼ˆç”¨æˆ·æƒé™ï¼‰+ æ¨¡å—äºŒï¼ˆåŸºç¡€æ•°æ®ï¼‰

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™

### 1. æ¶æ„ä¸€è‡´æ€§
- **APIå“åº”æ ¼å¼**ï¼šç»Ÿä¸€ä½¿ç”¨ `response.data.success` + `response.data.data.data` æ¨¡å¼
- **æƒé™æ§åˆ¶**ï¼šå¤ç”¨ç°æœ‰çš„ `user_type` å’Œ `organization_id` è¿‡æ»¤é€»è¾‘
- **æ•°æ®åº“è®¾è®¡**ï¼šéµå¾ªç°æœ‰è¡¨ç»“æ„è§„èŒƒï¼ˆè½¯åˆ é™¤ã€å®¡è®¡å­—æ®µç­‰ï¼‰
- **å‰ç«¯ç»„ä»¶**ï¼šå¤ç”¨ç°æœ‰çš„åˆ—è¡¨ã€è¡¨å•ã€åˆ†é¡µç­‰ç»„ä»¶æ¨¡å¼

### 2. æ•°æ®å…³è”è®¾è®¡
```sql
-- ä¸ç°æœ‰æ¨¡å—çš„å…³è”å…³ç³»
experiment_plans -> experiment_catalogs (å®éªŒè®¡åˆ’å…³è”å®éªŒç›®å½•)
experiment_plans -> curriculum_standards (å®éªŒè®¡åˆ’å…³è”è¯¾ç¨‹æ ‡å‡†)
experiment_records -> experiment_plans (å®éªŒè®°å½•å…³è”å®éªŒè®¡åˆ’)
experiment_records -> equipment (å®éªŒè®°å½•å…³è”è®¾å¤‡ä½¿ç”¨)
experiment_records -> materials (å®éªŒè®°å½•å…³è”ææ–™ä½¿ç”¨)
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### 1. å®éªŒè®¡åˆ’è¡¨ (experiment_plans)
```sql
CREATE TABLE experiment_plans (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(200) NOT NULL COMMENT 'è®¡åˆ’åç§°',
    code VARCHAR(50) UNIQUE COMMENT 'è®¡åˆ’ç¼–ç ',
    experiment_catalog_id BIGINT NOT NULL COMMENT 'å®éªŒç›®å½•ID',
    curriculum_standard_id BIGINT COMMENT 'è¯¾ç¨‹æ ‡å‡†ID',
    teacher_id BIGINT NOT NULL COMMENT 'æ•™å¸ˆID',
    class_name VARCHAR(100) COMMENT 'ç­çº§åç§°',
    student_count INT COMMENT 'å­¦ç”Ÿäººæ•°',
    planned_date DATE COMMENT 'è®¡åˆ’æ‰§è¡Œæ—¥æœŸ',
    planned_duration INT COMMENT 'è®¡åˆ’æ—¶é•¿(åˆ†é’Ÿ)',
    status ENUM('draft','pending','approved','rejected','executing','completed','cancelled') DEFAULT 'draft',
    description TEXT COMMENT 'è®¡åˆ’æè¿°',
    objectives TEXT COMMENT 'æ•™å­¦ç›®æ ‡',
    key_points TEXT COMMENT 'é‡ç‚¹éš¾ç‚¹',
    safety_requirements TEXT COMMENT 'å®‰å…¨è¦æ±‚',
    equipment_requirements JSON COMMENT 'è®¾å¤‡éœ€æ±‚',
    material_requirements JSON COMMENT 'ææ–™éœ€æ±‚',
    approval_notes TEXT COMMENT 'å®¡æ‰¹æ„è§',
    approved_by BIGINT COMMENT 'å®¡æ‰¹äººID',
    approved_at TIMESTAMP COMMENT 'å®¡æ‰¹æ—¶é—´',
    organization_id BIGINT NOT NULL COMMENT 'æ‰€å±ç»„ç»‡ID',
    created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
    updated_by BIGINT COMMENT 'æ›´æ–°äººID',
    extra_data JSON COMMENT 'æ‰©å±•æ•°æ®',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    INDEX idx_catalog_teacher (experiment_catalog_id, teacher_id),
    INDEX idx_organization_status (organization_id, status),
    INDEX idx_planned_date (planned_date),
    FOREIGN KEY (experiment_catalog_id) REFERENCES experiment_catalogs(id),
    FOREIGN KEY (curriculum_standard_id) REFERENCES curriculum_standards(id),
    FOREIGN KEY (teacher_id) REFERENCES users(id),
    FOREIGN KEY (organization_id) REFERENCES organizations(id)
);
```

### 2. å®éªŒè®°å½•è¡¨ (experiment_records)
```sql
CREATE TABLE experiment_records (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    experiment_plan_id BIGINT NOT NULL COMMENT 'å®éªŒè®¡åˆ’ID',
    execution_date DATE NOT NULL COMMENT 'æ‰§è¡Œæ—¥æœŸ',
    start_time TIME COMMENT 'å¼€å§‹æ—¶é—´',
    end_time TIME COMMENT 'ç»“æŸæ—¶é—´',
    actual_duration INT COMMENT 'å®é™…æ—¶é•¿(åˆ†é’Ÿ)',
    actual_student_count INT COMMENT 'å®é™…å‚ä¸å­¦ç”Ÿæ•°',
    completion_status ENUM('not_started','in_progress','partial','completed','cancelled') DEFAULT 'not_started',
    execution_notes TEXT COMMENT 'æ‰§è¡Œè¯´æ˜',
    problems_encountered TEXT COMMENT 'é‡åˆ°çš„é—®é¢˜',
    solutions_applied TEXT COMMENT 'è§£å†³æ–¹æ¡ˆ',
    teaching_reflection TEXT COMMENT 'æ•™å­¦åæ€',
    student_feedback TEXT COMMENT 'å­¦ç”Ÿåé¦ˆ',
    equipment_used JSON COMMENT 'ä½¿ç”¨çš„è®¾å¤‡',
    materials_consumed JSON COMMENT 'æ¶ˆè€—çš„ææ–™',
    photos JSON COMMENT 'å®éªŒç…§ç‰‡',
    data_records JSON COMMENT 'å®éªŒæ•°æ®è®°å½•',
    safety_incidents TEXT COMMENT 'å®‰å…¨äº‹ä»¶è®°å½•',
    status ENUM('draft','submitted','under_review','approved','rejected','revision_required') DEFAULT 'draft',
    review_notes TEXT COMMENT 'å®¡æ ¸æ„è§',
    reviewed_by BIGINT COMMENT 'å®¡æ ¸äººID',
    reviewed_at TIMESTAMP COMMENT 'å®¡æ ¸æ—¶é—´',
    organization_id BIGINT NOT NULL COMMENT 'æ‰€å±ç»„ç»‡ID',
    created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
    updated_by BIGINT COMMENT 'æ›´æ–°äººID',
    extra_data JSON COMMENT 'æ‰©å±•æ•°æ®',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    INDEX idx_plan_date (experiment_plan_id, execution_date),
    INDEX idx_organization_status (organization_id, status),
    INDEX idx_completion_status (completion_status),
    FOREIGN KEY (experiment_plan_id) REFERENCES experiment_plans(id),
    FOREIGN KEY (organization_id) REFERENCES organizations(id)
);
```

### 3. å®éªŒç…§ç‰‡è¡¨ (experiment_photos)
```sql
CREATE TABLE experiment_photos (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    experiment_record_id BIGINT NOT NULL COMMENT 'å®éªŒè®°å½•ID',
    photo_type ENUM('preparation','process','result','equipment','safety') NOT NULL COMMENT 'ç…§ç‰‡ç±»å‹',
    file_path VARCHAR(500) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
    file_name VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶å',
    file_size INT COMMENT 'æ–‡ä»¶å¤§å°(å­—èŠ‚)',
    mime_type VARCHAR(100) COMMENT 'MIMEç±»å‹',
    upload_method ENUM('mobile','web') DEFAULT 'web' COMMENT 'ä¸Šä¼ æ–¹å¼',
    location_info JSON COMMENT 'ä½ç½®ä¿¡æ¯(ç»çº¬åº¦)',
    timestamp_info JSON COMMENT 'æ—¶é—´æˆ³ä¿¡æ¯',
    watermark_applied BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²æ·»åŠ æ°´å°',
    ai_analysis_result JSON COMMENT 'AIåˆ†æç»“æœ',
    compliance_status ENUM('pending','compliant','non_compliant','needs_review') DEFAULT 'pending',
    description TEXT COMMENT 'ç…§ç‰‡æè¿°',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    organization_id BIGINT NOT NULL COMMENT 'æ‰€å±ç»„ç»‡ID',
    created_by BIGINT NOT NULL COMMENT 'åˆ›å»ºäººID',
    extra_data JSON COMMENT 'æ‰©å±•æ•°æ®',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    INDEX idx_record_type (experiment_record_id, photo_type),
    INDEX idx_compliance (compliance_status),
    FOREIGN KEY (experiment_record_id) REFERENCES experiment_records(id)
);
```

### 4. å®¡æ ¸æ—¥å¿—è¡¨ (experiment_review_logs)
```sql
CREATE TABLE experiment_review_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    experiment_record_id BIGINT NOT NULL COMMENT 'å®éªŒè®°å½•ID',
    review_type ENUM('submit','approve','reject','revision_request','force_complete') NOT NULL,
    previous_status VARCHAR(50) COMMENT 'ä¹‹å‰çŠ¶æ€',
    new_status VARCHAR(50) COMMENT 'æ–°çŠ¶æ€',
    review_notes TEXT COMMENT 'å®¡æ ¸æ„è§',
    attachment_files JSON COMMENT 'é™„ä»¶æ–‡ä»¶',
    reviewer_id BIGINT NOT NULL COMMENT 'å®¡æ ¸äººID',
    reviewer_role VARCHAR(50) COMMENT 'å®¡æ ¸äººè§’è‰²',
    organization_id BIGINT NOT NULL COMMENT 'æ‰€å±ç»„ç»‡ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_record_type (experiment_record_id, review_type),
    INDEX idx_reviewer_date (reviewer_id, created_at),
    FOREIGN KEY (experiment_record_id) REFERENCES experiment_records(id)
);
```

## ğŸ”§ åç«¯å¼€å‘è§„åˆ’

### 1. æ§åˆ¶å™¨è®¾è®¡
```php
// å®éªŒè®¡åˆ’æ§åˆ¶å™¨
app/Http/Controllers/Api/ExperimentPlanController.php
- index()      // è·å–è®¡åˆ’åˆ—è¡¨ï¼ˆæ”¯æŒæƒé™è¿‡æ»¤ï¼‰
- store()      // åˆ›å»ºè®¡åˆ’
- show()       // æŸ¥çœ‹è®¡åˆ’è¯¦æƒ…
- update()     // æ›´æ–°è®¡åˆ’
- destroy()    // åˆ é™¤è®¡åˆ’
- submit()     // æäº¤å®¡æ‰¹
- approve()    // å®¡æ‰¹é€šè¿‡
- reject()     // å®¡æ‰¹æ‹’ç»
- schedule()   // æ’è¯¾å…³è”

// å®éªŒè®°å½•æ§åˆ¶å™¨
app/Http/Controllers/Api/ExperimentRecordController.php
- index()      // è·å–è®°å½•åˆ—è¡¨
- store()      // åˆ›å»ºè®°å½•
- show()       // æŸ¥çœ‹è®°å½•è¯¦æƒ…
- update()     // æ›´æ–°è®°å½•
- destroy()    // åˆ é™¤è®°å½•
- submit()     // æäº¤å®¡æ ¸
- uploadPhoto() // ä¸Šä¼ ç…§ç‰‡
- validateData() // æ•°æ®éªŒè¯

// å®éªŒå®¡æ ¸æ§åˆ¶å™¨
app/Http/Controllers/Api/ExperimentReviewController.php
- index()      // è·å–å¾…å®¡æ ¸åˆ—è¡¨
- batchReview() // æ‰¹é‡å®¡æ ¸
- approve()    // å®¡æ ¸é€šè¿‡
- reject()     // æ‰“å›ä¿®æ”¹
- forceComplete() // å¼ºåˆ¶å®Œæˆ
- getReviewLogs() // è·å–å®¡æ ¸æ—¥å¿—

// å®éªŒæ—¥å†æ§åˆ¶å™¨
app/Http/Controllers/Api/ExperimentCalendarController.php
- getCalendarData() // è·å–æ—¥å†æ•°æ®
- getOverdueAlerts() // è·å–é€¾æœŸé¢„è­¦
- getExperimentDetails() // è·å–å®éªŒè¯¦æƒ…

// å®éªŒç›‘æ§æ§åˆ¶å™¨
app/Http/Controllers/Api/ExperimentMonitorController.php
- getDashboard() // è·å–ç›‘æ§çœ‹æ¿
- getProgressStats() // è·å–è¿›åº¦ç»Ÿè®¡
- getAnomalyAnalysis() // è·å–å¼‚å¸¸åˆ†æ
```

### 2. æ¨¡å‹å…³è”è®¾è®¡
```php
// ExperimentPlan æ¨¡å‹
class ExperimentPlan extends Model {
    public function experimentCatalog() {
        return $this->belongsTo(ExperimentCatalog::class);
    }
    
    public function curriculumStandard() {
        return $this->belongsTo(CurriculumStandard::class);
    }
    
    public function teacher() {
        return $this->belongsTo(User::class, 'teacher_id');
    }
    
    public function records() {
        return $this->hasMany(ExperimentRecord::class);
    }
    
    public function organization() {
        return $this->belongsTo(Organization::class);
    }
}

// ExperimentRecord æ¨¡å‹
class ExperimentRecord extends Model {
    public function plan() {
        return $this->belongsTo(ExperimentPlan::class, 'experiment_plan_id');
    }
    
    public function photos() {
        return $this->hasMany(ExperimentPhoto::class);
    }
    
    public function reviewLogs() {
        return $this->hasMany(ExperimentReviewLog::class);
    }
}
```

## ğŸ¨ å‰ç«¯å¼€å‘è§„åˆ’

### 1. é¡µé¢ç»“æ„
```
frontend/src/views/experiment-process/
â”œâ”€â”€ plan/
â”‚   â”œâ”€â”€ PlanList.vue           // å®éªŒè®¡åˆ’åˆ—è¡¨
â”‚   â”œâ”€â”€ PlanForm.vue           // è®¡åˆ’åˆ›å»º/ç¼–è¾‘è¡¨å•
â”‚   â”œâ”€â”€ PlanDetail.vue         // è®¡åˆ’è¯¦æƒ…é¡µé¢
â”‚   â””â”€â”€ PlanApproval.vue       // è®¡åˆ’å®¡æ‰¹é¡µé¢
â”œâ”€â”€ record/
â”‚   â”œâ”€â”€ RecordList.vue         // å®éªŒè®°å½•åˆ—è¡¨
â”‚   â”œâ”€â”€ RecordForm.vue         // è®°å½•å¡«æŠ¥è¡¨å•
â”‚   â”œâ”€â”€ RecordDetail.vue       // è®°å½•è¯¦æƒ…é¡µé¢
â”‚   â””â”€â”€ PhotoUpload.vue        // ç…§ç‰‡ä¸Šä¼ ç»„ä»¶
â”œâ”€â”€ review/
â”‚   â”œâ”€â”€ ReviewList.vue         // å®¡æ ¸åˆ—è¡¨
â”‚   â”œâ”€â”€ BatchReview.vue        // æ‰¹é‡å®¡æ ¸
â”‚   â””â”€â”€ ReviewDetail.vue       // å®¡æ ¸è¯¦æƒ…
â”œâ”€â”€ calendar/
â”‚   â”œâ”€â”€ ExperimentCalendar.vue // å®éªŒæ—¥å†
â”‚   â””â”€â”€ CalendarDetail.vue     // æ—¥å†è¯¦æƒ…
â””â”€â”€ monitor/
    â”œâ”€â”€ Dashboard.vue          // ç›‘æ§çœ‹æ¿
    â””â”€â”€ ProgressAnalysis.vue   // è¿›åº¦åˆ†æ
```

### 2. APIæ¥å£è®¾è®¡
```javascript
// api/experimentProcess.js
export const experimentPlanApi = {
  getList(params) {
    return request.get('/experiment-plans', { params })
  },
  create(data) {
    return request.post('/experiment-plans', data)
  },
  update(id, data) {
    return request.put(`/experiment-plans/${id}`, data)
  },
  submit(id) {
    return request.post(`/experiment-plans/${id}/submit`)
  },
  approve(id, data) {
    return request.post(`/experiment-plans/${id}/approve`, data)
  }
}

export const experimentRecordApi = {
  getList(params) {
    return request.get('/experiment-records', { params })
  },
  create(data) {
    return request.post('/experiment-records', data)
  },
  uploadPhoto(recordId, formData) {
    return request.post(`/experiment-records/${recordId}/photos`, formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
  }
}
```

## ğŸ“… å¼€å‘æ—¶é—´è§„åˆ’

### ç¬¬ä¸€å‘¨ï¼šå®éªŒè®¡åˆ’ç”³æŠ¥åŠŸèƒ½
- æ•°æ®åº“è¡¨åˆ›å»ºå’Œè¿ç§»
- åç«¯APIå¼€å‘ï¼ˆè®¡åˆ’CRUDã€å®¡æ‰¹æµç¨‹ï¼‰
- å‰ç«¯é¡µé¢å¼€å‘ï¼ˆåˆ—è¡¨ã€è¡¨å•ã€å®¡æ‰¹ï¼‰

### ç¬¬äºŒå‘¨ï¼šå®éªŒè®°å½•å¡«æŠ¥åŠŸèƒ½
- å®éªŒè®°å½•ç›¸å…³è¡¨åˆ›å»º
- åç«¯APIå¼€å‘ï¼ˆè®°å½•CRUDã€ç…§ç‰‡ä¸Šä¼ ï¼‰
- å‰ç«¯é¡µé¢å¼€å‘ï¼ˆè®°å½•è¡¨å•ã€ç…§ç‰‡ä¸Šä¼ ï¼‰

### ç¬¬ä¸‰å‘¨ï¼šå®éªŒè®°å½•å®¡æ ¸åŠŸèƒ½
- å®¡æ ¸ç›¸å…³è¡¨å’ŒAPIå¼€å‘
- æ‰¹é‡å®¡æ ¸ã€AIåˆ†æåŠŸèƒ½
- å‰ç«¯å®¡æ ¸é¡µé¢å¼€å‘

### ç¬¬å››å‘¨ï¼šå®éªŒæ—¥å†å’Œç›‘æ§åŠŸèƒ½
- æ—¥å†æ•°æ®APIå¼€å‘
- ç›‘æ§çœ‹æ¿APIå¼€å‘
- å‰ç«¯æ—¥å†å’Œçœ‹æ¿é¡µé¢å¼€å‘

### ç¬¬äº”å‘¨ï¼šæµ‹è¯•å’Œä¼˜åŒ–
- åŠŸèƒ½æµ‹è¯•å’Œbugä¿®å¤
- æ€§èƒ½ä¼˜åŒ–
- æ–‡æ¡£å®Œå–„

## ğŸ” å…³é”®æŠ€æœ¯è¦ç‚¹

### 1. æƒé™æ§åˆ¶ä¸€è‡´æ€§
```php
// åœ¨æ‰€æœ‰æ§åˆ¶å™¨ä¸­ç»Ÿä¸€ä½¿ç”¨
$user = Auth::user();
if ($user->user_type !== 'admin') {
    $query->where('organization_id', $user->organization_id);
}
```

### 2. APIå“åº”æ ¼å¼ç»Ÿä¸€
```php
// æˆåŠŸå“åº”
return response()->json([
    'success' => true,
    'message' => 'æ“ä½œæˆåŠŸ',
    'data' => $data
]);

// é”™è¯¯å“åº”
return response()->json([
    'success' => false,
    'message' => 'é”™è¯¯ä¿¡æ¯',
    'errors' => $errors
], 400);
```

### 3. å‰ç«¯æ•°æ®å¤„ç†ç»Ÿä¸€
```javascript
const loadData = async () => {
  loading.value = true
  try {
    const response = await api.getList(params)
    if (response.data.success) {
      tableData.value = response.data.data.data
      pagination.total = response.data.data.total
    }
  } catch (error) {
    ElMessage.error('è·å–æ•°æ®å¤±è´¥ï¼š' + error.message)
  } finally {
    loading.value = false
  }
}
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç¡®è®¤éœ€æ±‚ç»†èŠ‚**ï¼šä¸æ‚¨ç¡®è®¤å…·ä½“çš„ä¸šåŠ¡æµç¨‹å’ŒåŠŸèƒ½è¦æ±‚
2. **åˆ›å»ºæ•°æ®åº“è¿ç§»**ï¼šå¼€å§‹ç¬¬ä¸€å‘¨çš„æ•°æ®åº“è¡¨åˆ›å»º
3. **å¼€å‘å®éªŒè®¡åˆ’åŠŸèƒ½**ï¼šä»æœ€åŸºç¡€çš„CRUDåŠŸèƒ½å¼€å§‹
4. **é€æ­¥å®Œå–„åŠŸèƒ½**ï¼šæŒ‰ç…§è§„åˆ’é€æ­¥æ·»åŠ å¤æ‚åŠŸèƒ½

è¿™ä¸ªè§„åˆ’ç¡®ä¿äº†ä¸ç°æœ‰æ¨¡å—çš„å®Œå…¨ä¸€è‡´æ€§ï¼Œæ‚¨è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆå¦‚ä½•ï¼Ÿéœ€è¦æˆ‘å¼€å§‹å…·ä½“çš„å¼€å‘å·¥ä½œå—ï¼Ÿ
